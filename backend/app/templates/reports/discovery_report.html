<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Discovery Report - {{ problem_title }}</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 2em;
        }
        h1, h2, h3 { color: #1a1a1a; }
        h1 { border-bottom: 3px solid #8b5cf6; padding-bottom: 0.5em; }
        h2 { border-bottom: 1px solid #ddd; padding-bottom: 0.3em; margin-top: 2em; }
        h3 { color: #6b7280; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 0.75em;
            text-align: left;
        }
        th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        tr:nth-child(even) { background-color: #f9fafb; }
        .metric-card {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-radius: 8px;
            padding: 1.5em;
            margin: 0.5em 0;
        }
        .metric-label {
            font-size: 0.9em;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #7c3aed;
        }
        .hypothesis-card {
            background: #fafafa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5em;
            margin: 1em 0;
            page-break-inside: avoid;
        }
        .hypothesis-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1em;
        }
        .hypothesis-rank {
            background: #7c3aed;
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .hypothesis-title {
            font-size: 1.1em;
            font-weight: 600;
            flex-grow: 1;
            margin: 0 1em;
        }
        .score-badge {
            background: #ddd6fe;
            color: #5b21b6;
            padding: 0.25em 0.75em;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .score-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5em;
            margin: 1em 0;
        }
        .score-item {
            text-align: center;
            padding: 0.5em;
            background: #f3f4f6;
            border-radius: 4px;
        }
        .score-label {
            font-size: 0.8em;
            color: #6b7280;
        }
        .score-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        .feasibility { color: #059669; }
        .novelty { color: #d97706; }
        .impact { color: #dc2626; }
        .insight-box {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 1em 1.5em;
            margin: 1em 0;
            border-radius: 0 8px 8px 0;
        }
        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1em 1.5em;
            margin: 1em 0;
            border-radius: 0 8px 8px 0;
        }
        .discovery-box {
            background: #faf5ff;
            border-left: 4px solid #8b5cf6;
            padding: 1em 1.5em;
            margin: 1em 0;
            border-radius: 0 8px 8px 0;
        }
        .tag {
            display: inline-block;
            background: #e5e7eb;
            color: #374151;
            padding: 0.25em 0.5em;
            border-radius: 4px;
            font-size: 0.85em;
            margin: 0.25em;
        }
        .tag-materials { background: #dbeafe; color: #1e40af; }
        .tag-process { background: #fef3c7; color: #92400e; }
        .tag-device { background: #dcfce7; color: #166534; }
        .toc {
            background: #f8fafc;
            padding: 1.5em;
            border-radius: 8px;
            margin: 1em 0;
        }
        .toc-item {
            margin: 0.5em 0;
        }
        .toc-item a {
            color: #7c3aed;
            text-decoration: none;
        }
        .literature-item {
            padding: 1em;
            border-bottom: 1px solid #e5e7eb;
        }
        .literature-item:last-child {
            border-bottom: none;
        }
        .patent-item {
            padding: 1em;
            background: #fffbeb;
            border-radius: 4px;
            margin: 0.5em 0;
        }
    </style>
</head>
<body>
    <header style="border-bottom: 2px solid #8b5cf6; padding-bottom: 1em; margin-bottom: 2em;">
        <h1 style="margin: 0; border: none;">Discovery Engine Report</h1>
        <p style="color: #666; margin: 0.5em 0 0 0;">{{ problem_title }}</p>
        <p style="color: #888; font-size: 0.9em;">Discovery ID: {{ discovery_id }} | Status: {{ discovery_status }}</p>
    </header>

    <nav class="toc">
        <h3 style="margin-top: 0;">Table of Contents</h3>
        <div class="toc-item"><a href="#executive-summary">1. Executive Summary</a></div>
        <div class="toc-item"><a href="#problem-analysis">2. Problem Analysis</a></div>
        <div class="toc-item"><a href="#hypotheses">3. Research Hypotheses (Top {{ hypotheses|length }})</a></div>
        <div class="toc-item"><a href="#literature">4. Literature Review</a></div>
        <div class="toc-item"><a href="#patents">5. Patent Landscape</a></div>
        <div class="toc-item"><a href="#materials">6. Materials Analysis</a></div>
        <div class="toc-item"><a href="#tea-analysis">7. TEA for Top Candidates</a></div>
        <div class="toc-item"><a href="#recommendations">8. Recommendations & Next Steps</a></div>
    </nav>

    <section id="executive-summary" class="executive-summary">
        <h2>1. Executive Summary</h2>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1em;">
            <div class="metric-card">
                <div class="metric-label">Hypotheses Generated</div>
                <div class="metric-value">{{ total_hypotheses }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">High-Priority Candidates</div>
                <div class="metric-value">{{ high_priority_count }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Papers Analyzed</div>
                <div class="metric-value">{{ papers_analyzed }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Patents Reviewed</div>
                <div class="metric-value">{{ patents_reviewed }}</div>
            </div>
        </div>

        <div class="discovery-box" style="margin-top: 1.5em;">
            <strong>Key Finding</strong>
            <p>{{ executive_summary }}</p>
        </div>

        {% if top_recommendation %}
        <div class="insight-box">
            <strong>Top Recommendation</strong>
            <p>{{ top_recommendation }}</p>
        </div>
        {% endif %}
    </section>

    <section id="problem-analysis" class="problem-analysis">
        <h2>2. Problem Analysis</h2>

        <h3>Problem Statement</h3>
        <div class="discovery-box">
            {{ problem_statement }}
        </div>

        {% if constraints %}
        <h3>Constraints & Requirements</h3>
        <table>
            <tr>
                <th>Constraint</th>
                <th>Value</th>
                <th>Rationale</th>
            </tr>
            {% for key, value in constraints.items() %}
            <tr>
                <td>{{ key }}</td>
                <td>{{ value.value if value.value else value }}</td>
                <td>{{ value.rationale if value.rationale else '-' }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}

        {% if scope_analysis %}
        <h3>Scope Analysis</h3>
        <p>{{ scope_analysis }}</p>
        {% endif %}
    </section>

    <section id="hypotheses" class="hypotheses">
        <h2>3. Research Hypotheses</h2>
        <p>The Discovery Engine generated {{ total_hypotheses }} hypotheses. The top {{ hypotheses|length }} ranked by combined score are presented below.</p>

        {% for hypothesis in hypotheses %}
        <div class="hypothesis-card">
            <div class="hypothesis-header">
                <div class="hypothesis-rank">{{ loop.index }}</div>
                <div class="hypothesis-title">{{ hypothesis.title }}</div>
                <div class="score-badge">Score: {{ hypothesis.combined_score|number(1) }}/10</div>
            </div>

            <p>{{ hypothesis.statement }}</p>

            <div class="score-grid">
                <div class="score-item">
                    <div class="score-label">Feasibility</div>
                    <div class="score-value feasibility">{{ hypothesis.feasibility }}/10</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Novelty</div>
                    <div class="score-value novelty">{{ hypothesis.novelty }}/10</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Impact</div>
                    <div class="score-value impact">{{ hypothesis.impact }}/10</div>
                </div>
            </div>

            <h4>Scientific Rationale</h4>
            <p>{{ hypothesis.rationale }}</p>

            {% if hypothesis.key_references %}
            <h4>Supporting Literature</h4>
            <ul>
                {% for ref in hypothesis.key_references[:3] %}
                <li>{{ ref }}</li>
                {% endfor %}
            </ul>
            {% endif %}

            {% if hypothesis.materials %}
            <h4>Relevant Materials</h4>
            {% for material in hypothesis.materials %}
            <span class="tag tag-materials">{{ material }}</span>
            {% endfor %}
            {% endif %}

            {% if hypothesis.next_steps %}
            <h4>Suggested Next Steps</h4>
            <ol>
                {% for step in hypothesis.next_steps %}
                <li>{{ step }}</li>
                {% endfor %}
            </ol>
            {% endif %}
        </div>
        {% endfor %}
    </section>

    {% if literature_synthesis %}
    <section id="literature" class="literature">
        <h2>4. Literature Review</h2>

        <h3>Synthesis</h3>
        <div class="insight-box">
            {{ literature_synthesis.summary|safe }}
        </div>

        {% if literature_synthesis.consensus %}
        <h3>Areas of Consensus</h3>
        <ul>
            {% for item in literature_synthesis.consensus %}
            <li>{{ item }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if literature_synthesis.contradictions %}
        <h3>Contradictory Findings</h3>
        <ul>
            {% for item in literature_synthesis.contradictions %}
            <li>{{ item }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if literature_synthesis.gaps %}
        <h3>Knowledge Gaps</h3>
        <ul>
            {% for item in literature_synthesis.gaps %}
            <li>{{ item }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        <h3>Key Papers</h3>
        {% for paper in literature_synthesis.key_papers[:10] %}
        <div class="literature-item">
            <strong>{{ paper.title }}</strong> ({{ paper.year }})
            <br><em>{{ paper.authors }}</em>
            <br><span style="color: #666;">{{ paper.journal }}</span>
            {% if paper.relevance_note %}
            <br><span style="color: #7c3aed;">Relevance: {{ paper.relevance_note }}</span>
            {% endif %}
        </div>
        {% endfor %}
    </section>
    {% endif %}

    {% if patent_landscape %}
    <section id="patents" class="patents">
        <h2>5. Patent Landscape</h2>

        <h3>Overview</h3>
        <p>{{ patent_landscape.overview }}</p>

        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1em; margin: 1em 0;">
            <div class="metric-card">
                <div class="metric-label">Total Patents</div>
                <div class="metric-value">{{ patent_landscape.total_patents }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Recent (5yr)</div>
                <div class="metric-value">{{ patent_landscape.recent_patents }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">White Space Score</div>
                <div class="metric-value">{{ patent_landscape.white_space_score }}/10</div>
            </div>
        </div>

        {% if patent_landscape.key_players %}
        <h3>Key Patent Holders</h3>
        <table>
            <tr>
                <th>Organization</th>
                <th>Patent Count</th>
                <th>Focus Areas</th>
            </tr>
            {% for player in patent_landscape.key_players %}
            <tr>
                <td>{{ player.name }}</td>
                <td>{{ player.patent_count }}</td>
                <td>{{ player.focus_areas|join(', ') }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}

        {% if patent_landscape.white_spaces %}
        <h3>White Space Opportunities</h3>
        <div class="insight-box">
            <p>Areas with limited patent coverage that may represent opportunities:</p>
            <ul>
                {% for space in patent_landscape.white_spaces %}
                <li>{{ space }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if patent_landscape.key_patents %}
        <h3>Key Patents</h3>
        {% for patent in patent_landscape.key_patents[:5] %}
        <div class="patent-item">
            <strong>{{ patent.title }}</strong>
            <br>{{ patent.number }} ({{ patent.year }}) - {{ patent.assignee }}
            {% if patent.relevance_note %}
            <br><span style="color: #7c3aed;">{{ patent.relevance_note }}</span>
            {% endif %}
        </div>
        {% endfor %}
        {% endif %}
    </section>
    {% endif %}

    {% if materials_analysis %}
    <section id="materials" class="materials">
        <h2>6. Materials Analysis</h2>

        <p>{{ materials_analysis.overview }}</p>

        {% if materials_analysis.candidates %}
        <h3>Candidate Materials</h3>
        <table>
            <tr>
                <th>Material</th>
                <th>Formula</th>
                <th>Key Property</th>
                <th>Source</th>
            </tr>
            {% for material in materials_analysis.candidates %}
            <tr>
                <td>{{ material.name }}</td>
                <td>{{ material.formula }}</td>
                <td>{{ material.key_property }}</td>
                <td>{{ material.source }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}

        {% if materials_analysis.property_targets %}
        <h3>Property Targets</h3>
        <table>
            <tr>
                <th>Property</th>
                <th>Target Value</th>
                <th>Best Candidate</th>
            </tr>
            {% for prop in materials_analysis.property_targets %}
            <tr>
                <td>{{ prop.property }}</td>
                <td>{{ prop.target }}</td>
                <td>{{ prop.best_candidate }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}
    </section>
    {% endif %}

    {% if tea_candidates %}
    <section id="tea-analysis" class="tea-analysis">
        <h2>7. TEA for Top Candidates</h2>
        <p>Preliminary techno-economic analysis for the highest-ranked candidates.</p>

        <table>
            <tr>
                <th>Candidate</th>
                <th>Est. LCOE ($/MWh)</th>
                <th>Est. CAPEX ($/kW)</th>
                <th>TRL</th>
                <th>Time to Market</th>
            </tr>
            {% for candidate in tea_candidates %}
            <tr>
                <td>{{ candidate.name }}</td>
                <td>{{ candidate.lcoe|currency(2) if candidate.lcoe else 'TBD' }}</td>
                <td>{{ candidate.capex|currency if candidate.capex else 'TBD' }}</td>
                <td>{{ candidate.trl }}</td>
                <td>{{ candidate.time_to_market }}</td>
            </tr>
            {% endfor %}
        </table>

        <div class="warning-box">
            <strong>Note on Estimates</strong>
            <p>These are preliminary estimates based on analogous technologies and early-stage data.
               Detailed TEA should be conducted as concepts mature.</p>
        </div>
    </section>
    {% endif %}

    <section id="recommendations" class="recommendations">
        <h2>8. Recommendations & Next Steps</h2>

        {% if immediate_actions %}
        <h3>Immediate Actions (0-3 months)</h3>
        <ol>
            {% for action in immediate_actions %}
            <li>{{ action }}</li>
            {% endfor %}
        </ol>
        {% endif %}

        {% if medium_term_actions %}
        <h3>Medium-Term Actions (3-12 months)</h3>
        <ol>
            {% for action in medium_term_actions %}
            <li>{{ action }}</li>
            {% endfor %}
        </ol>
        {% endif %}

        {% if long_term_vision %}
        <h3>Long-Term Vision</h3>
        <div class="discovery-box">
            {{ long_term_vision }}
        </div>
        {% endif %}

        {% if risk_factors %}
        <h3>Key Risk Factors</h3>
        <table>
            <tr>
                <th>Risk</th>
                <th>Likelihood</th>
                <th>Impact</th>
                <th>Mitigation</th>
            </tr>
            {% for risk in risk_factors %}
            <tr>
                <td>{{ risk.description }}</td>
                <td>{{ risk.likelihood }}</td>
                <td>{{ risk.impact }}</td>
                <td>{{ risk.mitigation }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}
    </section>

    <section class="methodology">
        <h2>Methodology</h2>
        <p>This discovery report was generated using the following process:</p>
        <ol>
            <li><strong>Hypothesis Generation</strong>: Claude Opus 4.5 generated {{ total_hypotheses }} research hypotheses based on the problem statement and constraints.</li>
            <li><strong>Literature Search</strong>: Semantic Scholar and arXiv APIs were queried for relevant research papers.</li>
            <li><strong>Patent Analysis</strong>: USPTO and EPO databases were searched for relevant patents.</li>
            <li><strong>Materials Search</strong>: Materials Project database was queried for candidate materials.</li>
            <li><strong>Scoring</strong>: Hypotheses were scored on feasibility (can it be done?), novelty (is it new?), and impact (does it matter?).</li>
            <li><strong>Synthesis</strong>: Results were synthesized and ranked using Claude Opus 4.5.</li>
        </ol>

        <p><strong>AI Model Used</strong>: Claude Opus 4.5 (claude-opus-4-5-20251101)</p>
        <p><strong>Processing Time</strong>: {{ processing_time }}</p>
    </section>

    <footer style="margin-top: 3em; padding-top: 1em; border-top: 1px solid #ddd; font-size: 9pt; color: #666;">
        <p>Generated by {{ platform_name }} on {{ generated_at }}</p>
        {% if user_name %}<p>Prepared for: {{ user_name }}</p>{% endif %}
        <p style="font-style: italic;">This report represents AI-assisted research discovery. All hypotheses and recommendations should be validated through independent research and expert review before implementation.</p>
        <p style="font-style: italic;">Discovery Engine is powered by Claude Opus 4.5 for advanced reasoning and hypothesis generation.</p>
    </footer>
</body>
</html>
